# Simple design and construction of a Database for a manufacturing company.

## List of Tables produced by logical design:
Part (PID, Description)
Used in ((PID,COMPONENT_OF), Quantity, PID, Component_ of)
Order line (OLID, Quantity, PID, OID)
Orders (OID, O_Date)
Manifactured_Bulk (PID, Location)
Manifactured_To Order (PID, L_Time)
Bought (PID, Cost)
Supplier Part (SPID, Price, PID, SID)
Supplier/Bank Account (SID, Name, Address, S_Code, A_Number)

## SQL create statements:
```SQL
CREATE TABLE PART (
 PID VARCHAR(5),
 DESCRIPTION VARCHAR (50),
 CONSTRAINT PK_PART PRIMARY KEY(PID),
 CONSTRAINT PART_ID_LENGTH CHECK (LENGTH(PID) = 5)
);

CREATE TABLE USED_IN (
  QUANTITY NUMBER (5),
 PID  VARCHAR (5),
  COMPONENT_OF  VARCHAR (5),
 CONSTRAINT PK_USED_IN PRIMARY KEY(PID,COMPONENT_OF),
 CONSTRAINT FK_USED_IN_PID FOREIGN KEY (PID) REFERENCES PART(PID),
 CONSTRAINT FK_USED_IN_COMPONENT FOREIGN KEY (COMPONENT_OF) REFERENCES PART(PID)
);

CREATE TABLE ORDERS(
 OID VARCHAR (5),
 O_DATE DATE NOT NULL,
 CONSTRAINT PK_ORDER PRIMARY KEY(OID),
 CONSTRAINT ORDERS_ID_LENGTH CHECK (LENGTH(OID) = 5)
);

CREATE TABLE ORDER_LINE
(
  OLID     VARCHAR(5),
  QUANTITY NUMBER(5),
  PID      VARCHAR(5),
  OID      VARCHAR(5),
  CONSTRAINT PK_ORDER_LINE PRIMARY KEY (OLID),
  CONSTRAINT FK_ORDER_LINE_PID FOREIGN KEY (PID) REFERENCES PART (PID),
  CONSTRAINT FK_ORDER_LINE_OID FOREIGN KEY (OID) REFERENCES ORDERS (OID) ON DELETE CASCADE,
  CONSTRAINT ORDER_LINE_ID_LENGTH CHECK (LENGTH(OLID) = 5)
);

CREATE TABLE MANIFACTURED_BULK (
  PID VARCHAR (5),
  LOCATION VARCHAR(20),
 CONSTRAINT PK_M_BULK PRIMARY KEY (PID),
 CONSTRAINT FK_M_BULK FOREIGN KEY (PID) REFERENCES PART(PID) ON DELETE CASCADE
);

CREATE TABLE MANIFACTURED_TO_ODER (
  PID VARCHAR (5),
  L_TIME VARCHAR (20),
 CONSTRAINT PK_M_ORDER PRIMARY KEY(PID),
 CONSTRAINT FK_M_ORDER FOREIGN KEY (PID) REFERENCES PART(PID) ON DELETE CASCADE
);

CREATE TABLE BOUGHT (
  PID VARCHAR (5),
  COST FLOAT,
 CONSTRAINT PK_BOUGHT PRIMARY KEY(PID),
 CONSTRAINT FK_BOUGHT FOREIGN KEY (PID) REFERENCES PART(PID)
);

CREATE TABLE SUPPLIER (
 SID VARCHAR (5),
 NAME VARCHAR(20),
 ADDRESS VARCHAR(10),
 S_CODE VARCHAR(10),
 A_NUMBER VARCHAR(10),
 CONSTRAINT PK_SUPPLIER PRIMARY KEY(SID),
 CONSTRAINT SUPPLIER_ID_LENGTH CHECK (LENGTH(SID) = 5)
);

CREATE TABLE SUPPLIER_PART (
  SPID VARCHAR (5),
  PRICE FLOAT,
  PID VARCHAR (5),
  SID VARCHAR (5),
 CONSTRAINT PK_SUPPLIER_PART PRIMARY KEY(SPID),
 CONSTRAINT FK_SUPPLIER_PART_PID FOREIGN KEY (PID) REFERENCES BOUGHT(PID),
 CONSTRAINT FK_SUPPLIER_PART_SID FOREIGN KEY (SID) REFERENCES SUPPLIER(SID),
 CONSTRAINT SUPPLIER_PART_ID_LENGTH CHECK (LENGTH(SPID) = 5)
);
```
## SQL insert statements:
```SQL
INSERT INTO PART VALUES ('123AA', 'screw');
INSERT INTO PART VALUES ('123BB', 'bolt');
INSERT INTO PART VALUES ('123CC', 'nut');
INSERT INTO PART VALUES ('123DD', 'washer');
INSERT INTO PART VALUES ('123EE', 'wooden board');
INSERT INTO PART VALUES ('K0001', 'kit of bolt, nut and washer');
INSERT INTO PART VALUES ('K0002', 'kit wooden board and screws');
INSERT INTO PART VALUES ('KK001', 'big kit for DIY');

INSERT INTO MANIFACTURED_BULK VALUES ('KK001', '1 week');
INSERT INTO MANIFACTURED_TO_ODER VALUES ('K0002', 'rack 3 - row 5');

INSERT INTO USED_IN VALUES (5,'123BB', 'K0001');
INSERT INTO USED_IN VALUES (5,'123CC', 'K0001');
INSERT INTO USED_IN VALUES (5,'123DD', 'K0001');
INSERT INTO USED_IN VALUES (10,'123AA', 'K0002');
INSERT INTO USED_IN VALUES (2,'123EE', 'K0002');
INSERT INTO USED_IN VALUES (2,'K0001', 'KK001');
INSERT INTO USED_IN VALUES (2,'K0002', 'KK001');

INSERT INTO SUPPLIER VALUES ('AA111', 'Utensil Pro', 'G3OEL', '1234567A', 'B123456');
INSERT INTO SUPPLIER VALUES ('AA112', 'Wood Pro', 'G5OEL', '1234566A', 'B123455');

INSERT INTO SUPPLIER_PART VALUES ('521CC', 0.5, '123AA', 'AA111');
INSERT INTO SUPPLIER_PART VALUES ('522CC', 0.7, '123BB', 'AA111');
INSERT INTO SUPPLIER_PART VALUES ('523CC', 0.2, '123CC', 'AA111');
INSERT INTO SUPPLIER_PART VALUES ('524AB', 0.3, '123DD', 'AA111');
INSERT INTO SUPPLIER_PART VALUES ('533AB', 1, '123EE', 'AA112');

INSERT INTO ORDERS VALUES ('A1234', TO_DATE('12/01/2018', 'DD/MM/YYYY'));
INSERT INTO ORDERS VALUES ('A1235', TO_DATE('12/11/2018', 'DD/MM/YYYY'));
INSERT INTO ORDERS VALUES ('A1236', TO_DATE('10/08/2018', 'DD/MM/YYYY'));

INSERT INTO ORDER_LINE VALUES ('00001', 10, '123AA', 'A1234');
INSERT INTO ORDER_LINE VALUES ('00002', 5, '123BB', 'A1234');
INSERT INTO ORDER_LINE VALUES ('00003', 20, '123AA', 'A1235');
INSERT INTO ORDER_LINE VALUES ('00004', 50, '123EE', 'A1236');

INSERT INTO BOUGHT VALUES ('123AA', 0.7);
INSERT INTO BOUGHT VALUES ('123BB', 0.9);
INSERT INTO BOUGHT VALUES ('123EE', 1.3);
 ```
## SQL queries:
```SQL
set linesize 200
SET PAGESIZE 80

/*GROUP-BY QUERY to show which how many parts each supplier is providing and how much is the total price of them.*/
COLUMN TOTAL_PART_PRICE FORMAT $99,990.99
SELECT SUPPLIER.SID,COUNT(SUPPLIER_PART.SPID) AS N_PART_SUPPIED,SUM(SUPPLIER_PART.PRICE) AS TOTAL_PART_PRICE
FROM SUPPLIER,SUPPLIER_PART
WHERE SUPPLIER.SID = SUPPLIER_PART.SID
GROUP BY SUPPLIER.SID;

/* SUB-QUERY to show the most sensible parts,
the part that have a price over the average and then should be handled more carefully.
*/
SELECT  SUPPLIER.SID,SUPPLIER.NAME,PART.PID,PART.DESCRIPTION
FROM  PART,SUPPLIER,SUPPLIER_PART
WHERE PART.PID = SUPPLIER_PART.PID
  AND SUPPLIER.SID = SUPPLIER_PART.SID
  AND SUPPLIER_PART.PRICE > ( SELECT AVG (PRICE) FROM SUPPLIER_PART );

/*SELF-JOIN QUERY to show which part care the sub-parts of a composite part.*/
COLUMN  SUBPART FORMAT A7;
COLUMN  SUPERPART FORMAT A9;
SELECT SUBPART.PID AS SUBPART, SUPERPART.COMPONENT_OF AS SUPERPART
FROM USED_IN SUBPART,USED_IN SUPERPART
WHERE SUBPART.COMPONENT_OF = SUPERPART.PID;

/* SUB-QUERY to show the order and relative total amount of the second part of the year*/
COLUMN  ORDER_ID FORMAT A8;
COLUMN TOTAL_AMOUNT FORMAT $99,990.99
SELECT O.OID AS ORDER_ID,SUM(QUANTITY*COST) AS TOTAL_AMOUNT
FROM ORDERS O,ORDER_LINE,BOUGHT
WHERE O.OID = ORDER_LINE.OID
  AND ORDER_LINE.PID = BOUGHT.PID
  AND O.OID IN (SELECT OID FROM ORDERS
    WHERE O_DATE BETWEEN TO_DATE('01/06/2018','DD/MM/YYYY') AND TO_DATE('31/12/2018','DD/MM/YYYY'))
  GROUP BY ORDER_LINE.OID;

/* CORRELATED-QUERY to show the PID for bought parts with above average price for each supplier.*/
SELECT PID
FROM SUPPLIER_PART
WHERE PRICE > (SELECT AVG(PRICE)
FROM SUPPLIER_PART SP
		WHERE SUPPLIER_PART. SID = SP.SID);
```


